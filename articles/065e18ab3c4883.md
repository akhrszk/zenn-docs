---
title: "Reactã§setIntervalã‚’å®‰å…¨ã«ä½¿ã†ãŸã‚ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã‚’è€ƒãˆã‚‹"
emoji: "ğŸƒ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["React", "hooks"]
published: true
---

# ã“ã®è¨˜äº‹ã«ã¤ã„ã¦

ç°¡å˜ãªã‚¿ã‚¤ãƒãƒ¼ã‚¢ãƒ—ãƒªã‚’ä½œã‚ŠãªãŒã‚‰ã€setInterval ã‚’ä¸Šæ‰‹ãä½¿ã†ãŸã‚ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯`useInterval` ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚

Gist ã« `useInterval` ã®ã‚³ãƒ¼ãƒ‰ã‚’ä¸Šã’ã¦ã„ã‚‹ã®ã§å®Œæˆç³»ã ã‘è¦‹ãŸã„æ–¹ã¯[ã“ã¡ã‚‰](https://gist.github.com/akhrszk/776e7f136f8c167d9e66adff1a2d63e5)ã‹ã‚‰è¦‹ã‚Œã¾ã™ã€‚

# ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¿ã‚¤ãƒãƒ¼ã‚’å®Ÿè£…ã—ã¦ã¿ã‚‹

ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãƒã‚¦ãƒ³ãƒˆã•ã‚ŒãŸã‚‰è‡ªå‹•çš„ã«ã‚¿ã‚¤ãƒãƒ¼ãŒé–‹å§‹ã•ã‚Œã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒƒãƒˆãŒã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã•ã‚ŒãŸã‚‰è‡ªå‹•çš„ã«æ­¢ã¾ã‚‹ã‚ˆã†ã«ã—ãŸã„ã¨ã—ã¾ã™ã€‚

ã¨ã‚Šã‚ãˆãšç´ ç›´ã«å®Ÿè£…ã—ã¦ã¿ã¾ã™ã€‚

setInterval ã‚’ä¾¿åˆ©ã«ä½¿ã†ãŸã‚ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã‚’å®Ÿè£…ã—ã¦ã¿ã¾ã™ã€‚

```typescript:useInterval.ts
import { useEffect } from "react"

type Params = {
  onUpdate: () => void
}

export const useInterval = ({ onUpdate }: Params) => {
  useEffect(() => {
    const timerId = setInterval(() => onUpdate(), 1000)
    return () => clearInterval(timerId)
  }, [])
}
```

ä¸Šè¨˜ã® `useInterval` ã‚’ä½¿ã£ã¦ã‚¿ã‚¤ãƒãƒ¼ã‚’å®Ÿè£…ã—ã¾ã™ã€‚æ™‚é–“ã®ç®¡ç†ã¯ React ã‚‰ã—ã `state` ã§ç®¡ç†ã—ã¾ã™ã€‚ (ã‚¿ã‚¤ãƒãƒ¼ã®åˆæœŸå€¤ã¯ 180 ç§’ã¨ã—ã¾ã—ã‚‡ã†ã€‚)
1000 ãƒŸãƒªç§’ã”ã¨ã«`onUpdate`ãŒå‘¼ã°ã‚Œ`setState`ã§ 1 ç§’ãšã¤ãƒ‡ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã—ã¦ã„ãã¾ã™ã€‚

```typescript:Timer.tsx
import React, { useState } from 'react';
import { useInterval } from './useInterval';

export const Timer: React.FC = () => {
  const [time, setTime] = useState(180)
  useInterval({ onUpdate: () => setTime(time - 1)})
  return (<div>{time}</div>)
}

export default Timer;
```

å®Œæˆã§ã™ã€‚ã•ã¦ã€å‹•ã‹ã—ã¦ã¿ã¾ã™ï¼ï¼

ç”»é¢ã®è¡¨ç¤ºã‚’è¦‹ã¦ã¿ã‚‹ã¨ã€ã€Œ180ã€179ã€ã€ã€ã€ã€

**ã‚ã‚Œã€ã€ã€ï¼Ÿå‹•ã‹ãªã„ï¼Ÿï¼Ÿ**

åˆæœŸå€¤ã® 180 ã‹ã‚‰ 179 ã«ã¯å¤‰ã‚ã‚Šã¾ã—ãŸãŒã€ãã‚Œä»¥é™å‹•ããŒæ­¢ã¾ã£ã¦ã—ã¾ã„ã¾ã—ãŸã€‚

ã“ã‚Œ React åˆå­¦è€…ãŒå¿…ãšè¸ã‚€è½ã¨ã—ç©´ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ï¼Ÿ
ä»Šå›ã¯ã€ã“ã®ç¾è±¡ã‚’æ·±å €ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚

### ã¨ã‚Šã‚ãˆãšãƒ­ã‚°ã‚’å‡ºã™

ã“ã®ç¾è±¡ã‚’è§£æ±ºã™ã‚‹ãŸã‚ã®ãªã«ã‹ã—ã‚‰ã®ãƒ’ãƒ³ãƒˆã‚’å¾—ã‚‹ãŸã‚ã«ã€ã¨ã‚Šã‚ãˆãšãƒ­ã‚°ã‚’å‡ºã—ã¦ã¿ã¾ã™ã€‚

`useInterval` ã«æ¸¡ã™ `onUpdate` ã®ä¸­èº«ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãæ›ãˆã¾ã™ã€‚

```typescript:Timer.tsx
onUpdate: () => {
  console.log('onUpdate', 'time:', time)
  setTime(time - 1)
}
```

ã™ã‚‹ã¨ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã¯

```:console
onUpdate time: 180
onUpdate time: 180
onUpdate time: 180
...
```

`onUpdate` ãŒæ¯ç§’å‘¼ã°ã‚Œã¦ã„ã‚‹ã“ã¨ã¯ç¢ºèªã§ãã¾ã™ã­ã€‚ã—ã‹ã—ã€`time` ã®å€¤ãŒå¤ã„ã¾ã¾ã§ã™ã€‚
`setTime` ã‚’å‘¼ã‚“ã§ã„ã‚‹ã®ã« `time` ãŒæ›´æ–°ã•ã‚Œãªã„ã€ã€ã€ï¼Ÿ

ã„ã„ãˆã€‚`time` ãŒæ›´æ–°ã•ã‚Œã¦ã„ãªã„ã®ã§ã¯ãªãã€å¤ã„`time`ã‚’ãšã£ã¨å‚ç…§ã—ç¶šã‘ã¦ã—ã¾ã£ã¦ã„ã‚‹ã®ã§ã™ã€‚

çŠ¯äººã¯**ã“ã„ã¤**ã§ã™ã€‚ `useEffect` ã®ä¸­ã§å‘¼ã‚“ã§ã„ã‚‹ `onUpdate`ã®å‚ç…§ãŒå¤ã„ã¾ã¾ãªã®ã§ã™ã€‚

```typescript:useInterval.ts
export const useInterval = ({ onUpdate }: Params) => {
  useEffect(() => {
    const timerId = setInterval(() => onUpdate(), 1000)
    return () => clearInterval(timerId)
  }, [])
}
```

**ãªã‚‹ã»ã©ï¼ã¨ãªã‚‹ã¨ã€ã€ã€**

### `useEffect` ã®ç¬¬ï¼’å¼•æ•°ã§ `onUpdate` ã‚’æ¸¡ã—ã¡ã‚ƒãˆã°è‰¯ã•ãã†ï¼

```typescript:useInterval.ts
export const useInterval = ({ onUpdate }: Params) => {
  useEffect(() => {
    const timerId = setInterval(() => onUpdate(), 1000)
    return () => clearInterval(timerId)
  }, [onUpdate])
}
```

**å‹•ã‹ã—ã¦ã¿ã¾ã™ï¼ï¼**

ç”»é¢ã®è¡¨ç¤ºã‚’è¦‹ã¦ã¿ã‚‹ã¨ã€ã€Œ180ã€179ã€178ã€177ã€176ã€175ã€...ã€

å‹•ãã¾ã—ãŸã­ï¼ï¼

ã€ã€ã€ä¸€è¦‹ã€æœŸå¾…é€šã‚Šã«å‹•ã„ã¦ã‚‹ã‚ˆã†ã«è¦‹ãˆã¾ã™ã‚ˆã­ï¼Ÿ

### ã‚ã‚Œï¼Ÿãªã‚“ã‹é•ã†ã‹ã‚‚ï¼Ÿ

`useInterval` ã®å‹•ãã‚’æ³¨æ„æ·±ãè¦‹ã¦ã¿ã‚‹ã¨ãŠã‹ã—ãªå‹•ãã‚’ã—ã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒ­ã‚°ã‚’ä»•è¾¼ã¿ã¾ã™ã€‚

```typescript:useInterval.ts
export const useInterval = ({ onUpdate }: Params) => {
  useEffect(() => {
    console.log('setInterval')
    const timerId = setInterval(() => onUpdate(), 1000)
    return () => {
      console.log('clearInterval')
      clearInterval(timerId)
    }
  }, [onUpdate])
}
```

ã•ã¦ã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’è¦‹ã¦ã¿ã‚‹ã¨...

```
setInterval
clearInterval
setInterval
clearInterval
setInterval
...
```

ãªã‚“ã¨ã€æ¯ç§’ `clearInterval` ã¨ `setInterval` ãŒå‘¼ã°ã‚Œç¶šã‘ã¦ã—ã¾ã£ã¦ã¾ã™ã€ã€ã€

ã“ã‚Œã¯ã€ `state` ãŒæ›´æ–°ã•ã‚Œã‚‹ã¨ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒèµ°ã‚Šã€ `onUpdate` ãŒå†åº¦æ¸¡ã•ã‚Œã€`useEffect` ãŒå®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã§ã™ã€‚

### ã“ã‚Œã¯ã„ã‘ãªã„ã€‚

æ•´ç†ã™ã‚‹ã¨ã€`useEffect`ã®ä¸­ã§å‘¼ã°ã‚Œã‚‹`onUpdate`ã®å‚ç…§ã¯æ›´æ–°ã•ã‚Œã¦æ¬²ã—ã„ã€‚ã—ã‹ã—ã€`useEffect`ã®ç¬¬ï¼’å¼•æ•°ã§`onUpdate`ã‚’æ¸¡ã—ã¦ã—ã¾ã†ã¨ã€æ¯ç§’ `useEffect` ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ãŒå‹•ã„ã¦ã—ã¾ã†ã€‚ã€‚ã€‚

**ã„ã£ãŸã„ã€ã©ã†ã™ã‚Œã°ã€ã€ã€**

ã“ã“ã§ç™»å ´ã™ã‚‹ã®ãŒ `useRef` ã§ã™ã€‚Ref ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã« `onUpdate` ã®æœ€æ–°ã®å‚ç…§ã‚’æ ¼ç´ã—ã¾ã™ã€‚
`useEffect` ã®ä¸­ã§ã¯ Ref ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«æ ¼ç´ã•ã‚Œã¦ã„ã‚‹æœ€æ–°ã® `onUpdate` ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚

```typescript:useInterval.ts
export const useInterval = ({ onUpdate }: Params) => {
  const onUpdateRef = useRef<OnUpdate>(() => {})
  useEffect(() => {
    onUpdateRef.current = onUpdate
  }, [onUpdate])
  useEffect(() => {
    const timerId = setInterval(() => onUpdateRef.current(), 1000)
    return () => clearInterval(timerId)
  }, [])
}
```

**å®Œæˆã§ã™ï¼ï¼ï¼**

ã“ã‚Œã§ `onUpdate` ã®æœ€æ–°ã®å‚ç…§ã‚’ `onUpdateRef` ã«æŒã¡ã¤ã¤ã€ ç„¡é§„ã« `clearInterval` ãŒèµ°ã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã›ã‚“ï¼

# useInterval ã®å®Œæˆç³»

`setInterval` ã‚’ä½¿ã†ãŸã‚ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ `useInterval` ã®å®Œæˆç³»ã¯ Gist ã«ä¸Šã’ã¦ã¾ã™ã€‚

https://gist.github.com/akhrszk/776e7f136f8c167d9e66adff1a2d63e5

ã“ã® `useInterval` ã‚’ä½¿ç”¨ã—ãŸã‚µãƒ³ãƒ—ãƒ«ã¯ä»¥ä¸‹ã®ãƒ¬ãƒã‚¸ãƒˆãƒªã«ä¸Šã’ã¦ã¾ã™ã€‚

https://github.com/akhrszk/react-clock

GitHub Pages ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã‚ã‚‹ã®ã§å‹•ãã‚‚ã®ã‚’è¦‹ãŸã„æ–¹ã¯[ã“ã¡ã‚‰](https://akhrszk.github.io/react-clock/)ã€‚

[![react-clock](/images/react-hooks-use-interval/react-clock.png)](https://akhrszk.github.io/react-clock/)

# å‚è€ƒ

- [Qiita - React + TypeScript: setInterval()ã‚’ React ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ãƒ¢ãƒ‡ãƒ«ã«åˆã‚ã›ã¦ãƒ•ãƒƒã‚¯ã«æ›¸ãæ›¿ãˆã‚‹ ãƒ¼ useInterval](https://qiita.com/FumioNonaka/items/587c3ed8545d820f330c)
- [React - Docs#useRef](https://ja.reactjs.org/docs/hooks-reference.html#useref)
- [GitHub - react-use/useInterval.ts](https://github.com/streamich/react-use/blob/master/src/useInterval.ts)
